<!DOCTYPE html>
<html>
<head>
<style>
html,body{margin:0;}
#container{margin:20px auto;width:800px;}
#content{background:#ccc;position:relative;top:0;left:0;float:left;}
#control{width:350px;float:left;border:#ccc solid 1px;border-left:none;height:596px;padding-left:18px;}
.cell,.flag,.bomb{background-repeat:no-repeat;}
.cell{float:left;border:1px #eee solid;width:24px;height:24px;line-height:24px;text-align:center;}
.flag{background-image:url(images/flag.gif);background-color:#bbb}
.bomb{background-image:url(images/heart.gif);}
.opened{background-color:#ddd}
.prompt{background-color:#aaa}
.msg{height:50px;width:100%;line-height:50px; position:absolute;top:-50px;text-align:center}
.clear{clear:both;}
.myBtn{cursor: pointer;border-bottom-right-radius: 4px;border-top-left-radius: 4px;border-top-right-radius: 4px;border-bottom-left-radius: 4px;border: 1px solid #d3d3d3;background: #e6e6e6 url(images/myBtn.png) 50% 50% repeat-x;font-weight: normal;color: #555555;}
.myBtn.hover{border: 1px solid #999999;background: #dadada url(images/myBtnHover.png) 50% 50% repeat-x;}
</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
<script>
var cellWidth=24;
var cellHeight=cellWidth;
var height=23;
var width=16;
var boomArr = new Array;
var arr = new Array(width*height);
var openedArr=new Array(width*height);
boomArr=[33,36,37,39,40,43,46,49,51,54,57,59,62,65,67,73,75,78,81,84,88,91,94,97,101,103,107,110,113,118,124,125];
for(i=0;i<boomArr.length;i++){
	arr[boomArr[i]]=-1;
}
for(i=0;i<arr.length;i++){
	if(arr[i]==-1) continue;
	if(arr[i]==undefined) arr[i]=0;
	if(arr[i-width]==-1) arr[i]++;
	if(arr[i+width]==-1) arr[i]++;
	if(i%width>=1){
		if(arr[i-width-1]==-1) arr[i]++;
		if(arr[i-1]==-1) arr[i]++;
		if(arr[i+width-1]==-1) arr[i]++;
	}
	if(i%width<width-1){
		if(arr[i-width+1]==-1) arr[i]++;
		if(arr[i+1]==-1) arr[i]++;
		if(arr[i+width+1]==-1) arr[i]++;
	}
}
$(function(){
	var saveTop=parseInt($(".msg").css("top"));
	function fail(){
		$(".cell").fadeOut();
		var msgHeight=$(".msg").height();
		$(".msg").animate({
			"top":height*cellHeight/2-msgHeight/2
		})
	}
	function newGame(){
		$(".msg").animate({
			"top":saveTop
		})
		for(i=0;i<openedArr.length;i++){
			openedArr[i]=0;
		}
		$(".bomb").removeClass("bomb");
		$(".opened").removeClass("opened");
		$(".flag").removeClass("flag");
		$(".prompt").removeClass("prompt");
		$(".cell").html("").fadeIn();
		
	}
	function open(i){
		if(i<0||i>=width*height){
			return false;
		}
		if(openedArr[i]==1){
			return false;
		}
		openedArr[i]=1;
		if(arr[i]==-1){
			$(".cell").eq(i).addClass("bomb");
			fail();
			return false;	
		}
		$(".cell").eq(i).html(arr[i]).addClass("opened");
		if(arr[i]==0){
			open(i-width);
			open(i+width);
			if(i%width>=1){
				open(i-width-1);
				open(i-1);
				open(i+width-1);	
			}
			if(i%width<width-1){
				open(i-width+1);
				open(i+1);
				open(i+width+1);
			}
		}
		
	}
	$("#content").bind("contextmenu",function(e){
		return false;
	});
	$(".myBtn").mouseenter(function(){
		$(this).addClass("hover");
	}).mouseleave(function(){
		$(this).removeClass("hover");
	}).click(function(){
		newGame();
	})
	$(".cell").live({
		"click":function(event){
			if(!$(this).hasClass("flag")){
				console.log("hi");
				open($(".cell").index(this));
			}
		},
		"mouseup":function(event){
			if(event.which==3){
				if($(this).hasClass("opened")){
					return false;
				}
				$(this).toggleClass("flag");
			}
			return false;
		},
		"mouseenter":function(){
			var i=$(".cell").index(this);
			if(i-width>=0){$(".cell").eq(i-width).addClass("prompt")};
			if(i+width<width*height){$(".cell").eq(i+width).addClass("prompt")};
			if(i%width>=1){		
				$(".cell").eq(i-width-1).addClass("prompt");
				$(".cell").eq(i-1).addClass("prompt");
				$(".cell").eq(i+width-1).addClass("prompt");
			}
			if(i%width<width-1){
				$(".cell").eq(i-width+1).addClass("prompt");
				$(".cell").eq(i+1).addClass("prompt");
				$(".cell").eq(i+width+1).addClass("prompt");
			}
		},
		"mouseleave":function(){
			$(".prompt").removeClass("prompt");
		}
	})
})
</script>
</head>
<body>
<div id="container">
	<div id="content">
		<script>
			document.getElementById("content").style.height=(cellHeight+2)*height+"px";
			document.getElementById("content").style.width=(cellWidth+2)*width+"px";
			for(i=0;i<width*height;i++){
				document.write("<div class='cell'></div>")
			}
		</script>
		<div class="msg">GAME OVER</div>
	</div>
	<div id="control">
		<h3>USAGE:</h3>
		<p>Right click mark mine</p>
		<p>Left click open box</p>
		<p><button class="myBtn">NEW GAME</button></p>
	</div>
	<div class="clear"></div>
</div>
<div style="display:none">
<img src="images/bomb.gif" />
<img src="images/heart.gif" />
<img src="images/flag.gif" />
</div>
</body>
</html>
